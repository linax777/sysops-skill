---
name: sysops-skill
description: 從系統維運知識庫 (SysOps Knowledge Base) 檢索與回答問題。當使用者詢問關於系統架構、SOP、告警處理建議或系統參數時使用 (例如：「查詢 Nginx 的配置參數」或「如何處理告警 ID 1234」)。不適用於撰寫新程式碼、修改系統設定、單純除錯或進行一般網路搜尋。
---

# 系統維運知識庫檢索 (sysops-skill)

此技能定義了在「系統維運知識庫 (Knowledge Base)」中檢索資訊的標準作業程序。

## 資源結構
- `SKILL.md`: 核心檢索邏輯與導航步驟。
- `assets/reply_template.md`: 最後輸出給使用者的回覆格式範本。

## 目標知識庫根目錄定位
預設的知識庫分析目標為當前專案下的 `./references/`。 
如果使用者在對話中明確指定了其他路徑，請使用使用者指定的路徑作為知識庫根目錄。
**注意**：切勿使用 glob 猜測目錄存在與否。請使用 shell 功能 (如 `test -d`) 確認目錄是否存在。如果目標目錄不存在，請停止執行並詢問使用者的實際知識庫路徑。

## 執行步驟 (Execution Steps)

Step 1: Extract Keywords and Constraints
從使用者的提問中提取 3-8 個核心關鍵字 (包含可能的英文縮寫、同義詞、系統名稱如 Nginx)。同時提取任何時間或範圍限制。

Step 2: Check for Fast-Path Constraints
評估是否有精確條件可以直接跳過層層目錄探索：
- 若問題含有明確的「告警 ID」或「錯誤碼」：直接並優先搜尋知識庫內的 `01_triage_rules/alarm_mapping/` 目錄或 `symptoms_check.md`，使用 `grep` 檢索。跳至 Step 4。
- 若問題含有確切的「檔案名稱」：直接遞迴尋找該檔案名稱。跳至 Step 4。
- 若問題無精確條件，請進入 Step 3。

Step 3: Navigate Catalog Indexes (index.md)
從知識庫根目錄開始，逐層探勘 `index.md` 以縮小搜尋範圍：
1. 讀取當前目錄的 `index.md` (前 300 行)。
2. 掃描檔案內容的 `Tags` 欄位與目錄/檔案用途說明。
3. 根據提取的關鍵字，選出最相關的子目錄或候選業務檔案。
4. **決策**：如果選出的是子目錄，請進入該子目錄，並重複 Step 3 讀取其底下的 `index.md`。如果選出的是具體業務檔案 (例如 `.md`, `.yaml`, `.txt`)，請將其列入候選清單，並進入 Step 4。

Step 4: Search Selected Files
對於清單中的每一個候選檔案，執行漸進式局部檢索 (至多嘗試 5 次)：
1. 優先使用 `grep` 搜尋關鍵字。
2. 針對命中的行數，僅讀取匹配區段附近的上下文（例如前後 50 行），絕對不要一次性讀取整份巨大檔案。
3. 若當前檔案已提供足夠解答，跳至 Step 5。
4. 若資訊不足，切換至清單中的下一個候選檔案並重複。

Step 5: Format the Output
參考並嚴格遵守 `./assets/reply_template.md` 中的格式回覆使用者。
若經過上述流程仍找不到足夠的資訊，請在輸出中明確說明，並提示使用者給予更多限制範圍。

## 目錄設計指南 (針對知識庫維護者)
為確保檢索效率，請維持知識庫中的 `index.md` 符合以下原則：
- **摘要式群組**：在領域大類中僅列出重點入口與目錄用途，不要窮舉底層所有檔案。
- **標籤化**：只有在底層葉節點目錄中才窮舉檔案，並強制加上 `Tags: [標籤]` 前綴以利自動化檢索。